## 整体架构

为了整体结构清晰，将游戏内容以场景为单位进行划分

- 战斗场景
- 地图场景
- 互动场景
- 资源管理场景

在文档中会出现加黑的**名词概念**，是一些专有名词，其解释会以h4标题的形式展示，并置于合适位置与文档最后方

## 战斗场景

![[战斗场景草图.png]]

### 准备阶段

在战斗前，会进入准备阶段。这个阶段用于对团队的装备与阵型进行配置
可执行的操作如下
- 更换**团队队形**
- 更换**角色装备**
- 选取**角色手牌配置**
其中，更换**角色装备**与**角色手牌配置**一定程度上重合，因为装备可能拥有**装备附带手牌**

#### 团队队形

团队队形用于体现前排后排机制，通过团队队形的设置来一定程度上实现伤害的分配以及攻击距离等机制

每一次战斗，都发生在特定的一个**战斗地图场景**中，**战斗地图场景**包含环境buff与**战场宽度**两种特性，**战场宽度**则限制了团队站位。在准备阶段，我方队伍和敌方队伍根据**遭遇类型**决定**分配阶段宽度**，即在分配阶段时，拥有多少格用于放置角色。
- 遭遇: 普通遭遇，双方对等，敌我双方**分配阶段宽度**各占50%的**战场宽度**
- 奇袭: 奇袭敌人，处于优势，我方**分配阶段宽度**占有60%的**战场宽度**
- 遇袭: 遭遇袭击，处于劣势，我方**分配阶段宽度**占有40%的**战场宽度**

准备阶段玩家在可用的**分配阶段宽度**中放置角色，每格最多放置一个有行动能力的角色与若干失去行动能力的角色
注意: 宽度也可以影响放置角色的数量

战斗开始时，角色之间的攻击受到团队队形的影响如下

设攻击者为Atk, 被攻击者为Tar, 两者之间距离为X

攻击者发动攻击时，首先判定是否为近战攻击

- 近战攻击
	- 攻击者的攻击范围由其速度决定，若攻击者的攻击范围Y小于X则无法选中Tar目标
	- 若敌人在攻击范围内，则开始判定在Tar前方的Tar友军单位，Atk需要对Tar前方的每个Tar友军单位都进行一次判断，若判断失败则会受到该单位的一次**乘机攻击**，若在此过程中**失去行动能力**，则攻击停止，Atk在判定失败的单位处进入**失去行动能力**状态。若成功判断则对Tar造成应有的伤害
- 远程攻击
	- 远程攻击同样拥有攻击范围，具体决定因素则根据其特性决定
	- 远程攻击的形式分为**射击型**与**释放型**，其中**射击型**会受到团队队形的影响，若Tar之前的友方单位使用了**溅射阻挡**类的技能，则前排队友可以对射击类攻击进行阻挡。**释放型**则在其攻击范围内之间释放，只与距离有关，与队形无关

#### 角色装备

选择合适的角色装备是用于提高角色属性的有效途径之一，目前角色装备分为三类

- **武器**
- **护甲**
- **饰品**

某些装备需要角色能力达到某一数值，否则无法装备。装备的数量也会受到某些因素限制，比如一个角色最多装备一个双手武器或两个单手武器，角色每个部位只能装备一个对应的护甲，饰品的可装备数量则和某些道具有关。

装备也存在重量这一属性，过于装备过于沉重的装备会给角色带来一定的debuff

在准备阶段，玩家可对每个角色的装备进行配置和更改。在战斗阶段，装备的更改需要打出一张装备更改卡，该卡消耗较大，使得战局中的装备更改需要较大的代价。这鼓励玩家提前做好准备，减少在战斗中的装备更改

#### 角色手牌配置

每次准备阶段时，玩家需要对每个角色的手牌进行配置

每个角色只能携带一定数量的牌，限制主要是重量和空间。在战斗中的每个回合，玩家只能从携带的牌中选择并作为当前回合的手牌。

携带牌可以在友方不同角色间进行传递，但需要在该角色的回合打出一张交换卡来进行

#### 战场宽度

**战斗地图场景**的属性，以5m为单位，每5m为一格

#### 遭遇类型

遭遇类型分为三种，并各自带有一定的buff或debuff

- 遭遇: 普通遭遇，双方公平，正常战斗
- 奇袭: 奇袭敌人，我方优势
	- 我方**分配阶段宽度**占有60%的**战场宽度**
	- 我方全体获得持续两回合的奇袭buff
	- 敌方全体获得持续两回合的遇袭debuff
- 遇袭: 遭遇袭击，我方劣势
	- 我方**分配阶段宽度**占有40%的**战场宽度**
	- 我方全体获得持续两回合的遇袭debuff
	- 敌方全体获得持续两回合的奇袭buff

遭遇类型主要根据敌我双方的**情报值**决定，若**情报值**差距在30以内，则为遭遇战，否则情报较高一方为奇袭的遭遇类型，情报较低的一方为遇袭的遭遇类型

#### 情报值

在一张地图探索值，团队拥有在该地图的一个情报值，该值可以通过购买情报道具或者派出侦查队来提升，并随着探索的推进而不断减少

- 情报道具: 通过购买或搜寻的方式获得，获得某个地图的大量情报值
- 侦查队: 侦查队用于提高情报值，获得的情报值与侦查队总体的洞察值与侦查时间有关。在侦查过程中，侦查队与主力团队分离，在战斗过程中无法选用。侦查队的侦查时间与消耗的物质有关，消耗较多的物质可以提高侦查时间，获取更多的情报值

### 战斗阶段

在战斗阶段中，双方根据角色属性计算行动的顺序并依次行动。在该角色的回合时，在其携带卡牌中选择一定数量的可用卡牌作为手牌，并可以打出**手牌类型**拥有主动性的卡牌，保留剩余的手牌。结束回合后，则轮到下一个角色行动，直到一方全部进入**失去行动能力状态**时，战斗结束

战斗阶段主要内容由手牌内容决定

#### 手牌类型

手牌拥有一个重要属性，**使用性**，拥有以下两个值中的一个或多个

- 主动性: 在该角色的回合时，可指定目标直接打出，但在非其回合时无法打出
- 被动性: 在其他人以他为目标使用主动性牌时可打出，但不可主动打出
- 自动性: 在条件满足时强制自动打出，不需要由玩家手动打出

#### 失去行动能力

在某一角色的**健康值**低于某一阈值或者**焦虑值**高于某一阈值时，角色会进入**行动不能状态**。在某一角色的头部与胸部受到致命打击时，**角色死亡**。行动不能状态与死亡状态皆视为失去行动能力。但昏迷等buff并不算在其中

#### 行动不能状态

角色在**健康值**低于某一阈值或者**焦虑值**高于某一阈值时，角色进入该状态。该状态下角色的行动回合会被跳过,直至被其他角色救治。该状态下角色仍能遭到攻击，并在遭到致命攻击后死亡

若回合结束时，敌方角色仍处于行动不能状态，则可以该角色可以被俘虏

#### 角色死亡

角色在受到致命攻击后，会进入死亡状态。死亡不可避免，也不可逆转。

角色在以下状态下会死亡

- 头部生命值为0
- 胸部生命值为0

#### 健康值

此处健康值只包括血量，并不包括各自buff

角色分为以下几块健康值

- 头部健康值
- 胸部健康值
- 左手健康值
- 右手健康值
- 左腿健康值
- 右腿健康值

每一块的健康值分为四个阶段，分别为
- 100%~50%: 健康
- 50%~20%: 轻伤
- 20%~0%: 重伤
- 0: 完全损毁

头部或胸部完全损毁角色直接死亡，四肢完全损毁也无法恢复，只能依靠义肢等手段补救

#### 焦虑值

焦虑值是角色的一个状态值，会受到各种因素影响，包括疼痛，饥饿，寒冷等等，随着各种不利因素而增加

同样，焦虑值会随着各种行为而降低，包括治疗，温暖，饮酒等，随着各自放松因素而减少

根据人物属性，每个角色都有一个崩溃阈值，当焦虑值高于阈值时，该角色进入崩溃状态，直至其他角色对齐进行帮助才能够恢复


### 结算阶段

战斗胜利后，进入结算阶段。该阶段可以获得敌人拥有的道具，并可以俘虏所有失去行动能力的地方角色



## 地图场景

![[地图场景草图.png]]

地图场景为一张无向图，每一个节点都是一个地点场景，每一条边是一条路径

### 地点场景

每一个地点场景中，可能存在以下场景

- 对话场景
- 交易场景
- 探索场景
- 战斗场景
- 地图场景

所有可进入的场景都以列表的形式展现

### 路径

在不同的节点间移动需要消耗时间，且路径可能存在buff,对团队造成影响。团队可能在前进的过程中出现伤亡

团队的前进速度可以调整，玩家可以随时停止前进来补充状态，或选择后退至出发位置进行补给

## 对话场景

![[对话场景草图.png]]

对话场景即与NPC交互的一个场景，该场景包括一个卡牌槽用于表示发言者，一个对话框用于展示对话内容

其中对话框可能包括以下内容

- 普通文本: 用于展示普通的文字内容
- 选择事件: 给出选项（四个以内），用于作为分支触发不同事件
- 确认事件: 即一个确认按钮，确认后继续对话，并触发事件，用于重要事务的表示

## 交易场景

![[交易场景草图.png]]

交易场景用于玩家与NPC之间进行交换，本质上是以物易物（金钱本质上就是物品），主要分为两种模式

- 购买: 玩家选择需要的物品，商人出示需要的代价并将玩家背包内拥有的该类物品展示，玩家选择想要交易的物品后点击确认，交易完成
- 出售: 出售仅能用于换取金钱，玩家选择需要出售的物品，商人出示最终出售价，玩家同意后点击确认完成交易

## 探索场景

![[探索场景草图.png]]

探索场景用于玩家与地点内容进行交换，所有可交互内容都会展示在列表中，玩家可以自行选择是否交互。可交互内容可以包括

- 获得物资
- 触发事件
- 触发对话

根据选项来进入对应的场景或触发对应的事件

## 仓库场景

![[仓库场景草图.png]]

仓库包括以下几类仓库

- 固定仓库: 位于地图场景中的仓库，可以用于储存物资
- 角色仓库: 某个角色的物品栏及其所有携带的物品
- 团队仓库: 整个团队仓库的综合

仓库场景可以出现两个仓库，用于在两个仓库之间转移物资